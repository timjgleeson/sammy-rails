// -- Sammy.js -- /plugins/sammy.storage.js
// http://sammyjs.org
// Version: 0.7.4
// Built: 2013-01-27 13:34:15 -0500
(function(e){typeof define=="function"&&define.amd?define(["jquery","sammy"],e):(window.Sammy=window.Sammy||{}).Storage=e(window.jQuery,window.Sammy)})(function(e,t){return t.Store=function(n){var r=this;this.options=n||{},this.name=this.options.name||"store",this.element=this.options.element||"body",this.$element=e(this.element),e.isArray(this.options.type)?e.each(this.options.type,function(e,n){if(t.Store.isAvailable(n))return r.type=n,!1}):this.type=this.options.type||"memory",this.meta_key=this.options.meta_key||"__keys__",this.storage=new t.Store[t.Store.stores[this.type]](this.name,this.element,this.options)},t.Store.stores={memory:"Memory",data:"Data",local:"LocalStorage",session:"SessionStorage",cookie:"Cookie"},e.extend(t.Store.prototype,{isAvailable:function(){return e.isFunction(this.storage.isAvailable)?this.storage.isAvailable():!0},exists:function(e){return this.storage.exists(e)},set:function(e,t){var n=typeof t=="string"?t:JSON.stringify(t);return e=e.toString(),this.storage.set(e,n),e!=this.meta_key&&(this._addKey(e),this.$element.trigger("set-"+this.name,{key:e,value:t}),this.$element.trigger("set-"+this.name+"-"+e,{key:e,value:t})),t},get:function(e){var t=this.storage.get(e);if(typeof t=="undefined"||t==null||t=="")return t;try{return JSON.parse(t)}catch(n){return t}},clear:function(e){return this._removeKey(e),this.storage.clear(e)},clearAll:function(){var e=this;this.each(function(t,n){e.clear(t)})},keys:function(){return this.get(this.meta_key)||[]},each:function(e){var t=0,n=this.keys(),r;for(t;t<n.length;t++){r=e(n[t],this.get(n[t]));if(r===!1)return!1}},filter:function(e){var t=[];return this.each(function(n,r){return e(n,r)&&t.push([n,r]),!0}),t},first:function(e){var t=!1;return this.each(function(n,r){if(e(n,r))return t=[n,r],!1}),t},fetch:function(e,t){return this.exists(e)?this.get(e):this.set(e,t.apply(this))},load:function(t,n,r){var i=this;e.get(n,function(e){i.set(t,e),r&&r.apply(this,[e])})},_addKey:function(t){var n=this.keys();e.inArray(t,n)==-1&&n.push(t),this.set(this.meta_key,n)},_removeKey:function(t){var n=this.keys(),r=e.inArray(t,n);r!=-1&&n.splice(r,1),this.set(this.meta_key,n)}}),t.Store.isAvailable=function(e){try{return t.Store[t.Store.stores[e]].prototype.isAvailable()}catch(n){return!1}},t.Store.Memory=function(e,n){this.name=e,this.element=n,this.namespace=[this.element,this.name].join("."),t.Store.Memory.store=t.Store.Memory.store||{},t.Store.Memory.store[this.namespace]=t.Store.Memory.store[this.namespace]||{},this.store=t.Store.Memory.store[this.namespace]},e.extend(t.Store.Memory.prototype,{isAvailable:function(){return!0},exists:function(e){return typeof this.store[e]!="undefined"},set:function(e,t){return this.store[e]=t},get:function(e){return this.store[e]},clear:function(e){delete this.store[e]}}),t.Store.Data=function(t,n){this.name=t,this.element=n,this.$element=e(n)},e.extend(t.Store.Data.prototype,{isAvailable:function(){return!0},exists:function(e){return!!this.$element.data(this._key(e))},set:function(e,t){return this.$element.data(this._key(e),t)},get:function(e){return this.$element.data(this._key(e))},clear:function(e){this.$element.removeData(this._key(e))},_key:function(e){return["store",this.name,e].join(".")}}),t.Store.LocalStorage=function(e,t){this.name=e,this.element=t},e.extend(t.Store.LocalStorage.prototype,{isAvailable:function(){return"localStorage"in window&&window.location.protocol!="file:"},exists:function(e){return this.get(e)!=null},set:function(e,t){return window.localStorage.setItem(this._key(e),t)},get:function(e){return window.localStorage.getItem(this._key(e))},clear:function(e){window.localStorage.removeItem(this._key(e))},_key:function(e){return["store",this.element,this.name,e].join(".")}}),t.Store.SessionStorage=function(e,t){this.name=e,this.element=t},e.extend(t.Store.SessionStorage.prototype,{isAvailable:function(){return"sessionStorage"in window&&window.location.protocol!="file:"&&e.isFunction(window.sessionStorage.setItem)},exists:function(e){return this.get(e)!=null},set:function(e,t){return window.sessionStorage.setItem(this._key(e),t)},get:function(e){var t=window.sessionStorage.getItem(this._key(e));return t&&typeof t.value!="undefined"&&(t=t.value),t},clear:function(e){window.sessionStorage.removeItem(this._key(e))},_key:function(e){return["store",this.element,this.name,e].join(".")}}),t.Store.Cookie=function(e,t,n){this.name=e,this.element=t,this.options=n||{},this.path=this.options.path||"/",this.expires_in=this.options.expires_in||1209600},e.extend(t.Store.Cookie.prototype,{isAvailable:function(){return"cookie"in document&&window.location.protocol!="file:"},exists:function(e){return this.get(e)!=null},set:function(e,t){return this._setCookie(e,t)},get:function(e){return this._getCookie(e)},clear:function(e){this._setCookie(e,"",-1)},_key:function(e){return["store",this.element,this.name,e].join(".")},_getCookie:function(e){var t=this._key(e).replace(/(\.|\*|\(|\)|\[|\])/g,"\\$1"),n=document.cookie.match("(^|;\\s)"+t+"=([^;]*)(;|$)");return n?n[2]:null},_setCookie:function(e,t,n){n||(n=this.expires_in*1e3);var r=new Date;r.setTime(r.getTime()+n);var i=[this._key(e),"=",t,"; expires=",r.toGMTString(),"; path=",this.path].join("");document.cookie=i}}),t.Storage=function(n){this.use(t.JSON),this.stores=this.stores||{},this.store=function(n,r){if(typeof this.stores[n]=="undefined"){var i="clear"+n.substr(0,1).toUpperCase()+n.substr(1);this.stores[n]=new t.Store(e.extend({name:n,element:this.element_selector},r||{})),this[n]=function(t,r){return typeof r=="undefined"?this.stores[n].get(t):e.isFunction(r)?this.stores[n].fetch(t,r):this.stores[n].set(t,r)},this[i]=function(){return this.stores[n].clearAll()},this.helper(n,function(){return this.app[n].apply(this.app,arguments)}),this.helper(i,function(){return this.app[i]()})}return this.stores[n]},this.helpers({store:function(){return this.app.store.apply(this.app,arguments)}})},t.Session=function(n,r){this.use(t.Storage),this.store("session",e.extend({type:["local","cookie","memory"]},r))},t.Cache=function(n,r){this.use(t.Storage),this.cache_partials=!0,this.store("cache",e.extend({type:["local","session","memory"]},r))},t.Storage});